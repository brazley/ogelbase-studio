# DynaBase Observability Data Flow

## Metric Collection Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Tenant Query Flow                            â”‚
â”‚  (Each query generates observability data across all layers)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     Connection Manager (Instrumented)     â”‚
        â”‚                                           â”‚
        â”‚  â€¢ Tier state tracking                   â”‚
        â”‚  â€¢ Limit enforcement metrics             â”‚
        â”‚  â€¢ Queue depth measurement               â”‚
        â”‚  â€¢ Connection rejections                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â†“                       â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Prometheus Metrics  â”‚  â”‚   Event Log Stream   â”‚
        â”‚                      â”‚  â”‚                      â”‚
        â”‚  â€¢ Gauges (state)    â”‚  â”‚  â€¢ Tier transitions  â”‚
        â”‚  â€¢ Counters (events) â”‚  â”‚  â€¢ Limit hits        â”‚
        â”‚  â€¢ Histograms (dist) â”‚  â”‚  â€¢ Plan changes      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“                       â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Prometheus Server   â”‚  â”‚  TimescaleDB         â”‚
        â”‚                      â”‚  â”‚  (Event Storage)     â”‚
        â”‚  â€¢ Scrapes metrics   â”‚  â”‚                      â”‚
        â”‚  â€¢ Evaluates alerts  â”‚  â”‚  â€¢ Long-term trends  â”‚
        â”‚  â€¢ 30-day retention  â”‚  â”‚  â€¢ SQL analytics     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“                       â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Grafana Dashboards â”‚  â”‚   Business Analytics â”‚
        â”‚                      â”‚  â”‚                      â”‚
        â”‚  â€¢ Tier Health       â”‚  â”‚  â€¢ Tier Economics    â”‚
        â”‚  â€¢ Activity Patterns â”‚  â”‚  â€¢ Upsell Opportunities â”‚
        â”‚  â€¢ SLO Tracking      â”‚  â”‚  â€¢ Cost Attribution  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Alert Manager      â”‚
        â”‚                      â”‚
        â”‚  â€¢ PagerDuty         â”‚
        â”‚  â€¢ Slack             â”‚
        â”‚  â€¢ Email             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Metric Namespace Hierarchy

```
dynabase_
â”œâ”€â”€ tenant_
â”‚   â”œâ”€â”€ current_tier{project_id, database_type}
â”‚   â”œâ”€â”€ tier_duration_seconds{project_id, tier}
â”‚   â”œâ”€â”€ tier_transitions_total{project_id, from_tier, to_tier, reason}
â”‚   â”œâ”€â”€ activity_state{project_id}
â”‚   â”œâ”€â”€ limit_hits_total{project_id, tier, limit_type, action}
â”‚   â”œâ”€â”€ limit_queue_duration_seconds{project_id, tier, limit_type}
â”‚   â”œâ”€â”€ connection_queue_depth{project_id, tier}
â”‚   â”œâ”€â”€ connection_rejections_total{project_id, tier, reason}
â”‚   â”œâ”€â”€ cpu_usage_millicores{project_id, tier}
â”‚   â”œâ”€â”€ memory_usage_bytes{project_id, tier, pool_type}
â”‚   â”œâ”€â”€ io_bytes_total{project_id, tier, operation}
â”‚   â”œâ”€â”€ query_cost_distribution{project_id, tier}
â”‚   â”œâ”€â”€ scale_to_zero_total{project_id, tier, reason}
â”‚   â”œâ”€â”€ cold_starts_total{project_id, source_tier}
â”‚   â”œâ”€â”€ cold_start_duration_seconds{project_id, cache_level}
â”‚   â”œâ”€â”€ first_query_latency_seconds{project_id, tier}
â”‚   â”œâ”€â”€ plan_changes_total{project_id, from_tier, to_tier, change_type}
â”‚   â”œâ”€â”€ tier_ceiling_hits_total{project_id, tier, resource}
â”‚   â”œâ”€â”€ cache_hits_total{project_id, tier, cache_level}
â”‚   â”œâ”€â”€ cache_access_latency_seconds{project_id, cache_level}
â”‚   â”œâ”€â”€ cache_memory_bytes{project_id, tier, cache_level}
â”‚   â”œâ”€â”€ cache_evictions_total{project_id, tier, cache_level, reason}
â”‚   â”œâ”€â”€ query_rate_per_minute{project_id, tier}
â”‚   â”œâ”€â”€ queries_by_hour{project_id, tier, hour}
â”‚   â”œâ”€â”€ active_hours_per_day{project_id}
â”‚   â”œâ”€â”€ sustained_activity_periods_total{project_id, duration_category}
â”‚   â””â”€â”€ idle_duration_seconds{project_id, tier}
â”‚
â”œâ”€â”€ tenants_by_tier{tier}
â”œâ”€â”€ revenue_units_by_tier{tier}
â”‚
â”œâ”€â”€ slo_
â”‚   â”œâ”€â”€ query_latency_compliance{tier, slo_threshold_ms}
â”‚   â”œâ”€â”€ cold_start_compliance{tier, slo_threshold_ms}
â”‚   â””â”€â”€ availability_compliance{tier, slo_threshold_percent}
â”‚
â””â”€â”€ db_  (existing metrics from connection-manager.ts)
    â”œâ”€â”€ active_connections{database_type, tier, project_id}
    â”œâ”€â”€ pool_size{database_type, tier, status}
    â”œâ”€â”€ circuit_breaker_state{database_type, project_id}
    â”œâ”€â”€ queries_total{database_type, tier, status}
    â”œâ”€â”€ errors_total{database_type, tier, error_type}
    â”œâ”€â”€ circuit_breaker_open_total{database_type, project_id}
    â”œâ”€â”€ query_duration_seconds{database_type, tier, operation}
    â””â”€â”€ connection_acquire_duration_seconds{database_type, tier}
```

---

## Dashboard Visual Structure

### 1. Operational Dashboard: "DynaBase Tier Health"

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DynaBase Tier Health                                [Last 1h] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Tenant Dist.   â”‚  â”‚ Tier Transitions (rate)              â”‚ â”‚
â”‚  â”‚                â”‚  â”‚         â–²                            â”‚ â”‚
â”‚  â”‚  COLD: 45%     â”‚  â”‚        â”‚ â”‚                          â”‚ â”‚
â”‚  â”‚  WARM: 30%     â”‚  â”‚      â”Œâ”€â”˜ â””â”€â”                        â”‚ â”‚
â”‚  â”‚  HOT: 20%      â”‚  â”‚    â”Œâ”€â”˜     â””â”€â”     WARMâ†’HOT         â”‚ â”‚
â”‚  â”‚  PERSIST: 5%   â”‚  â”‚  â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ â”‚
â”‚  â”‚                â”‚  â”‚         Time                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Limit Hits by Tier (stacked)                             â”‚ â”‚
â”‚  â”‚  â–“â–“â–“ max_concurrent  â–‘â–‘â–‘ query_timeout                   â”‚ â”‚
â”‚  â”‚  â–“â–“â–‘                                                      â”‚ â”‚
â”‚  â”‚  â–“â–“â–‘â–‘    â–“                                               â”‚ â”‚
â”‚  â”‚  â–“â–“â–‘â–‘  â–“â–“â–‘    â–“                                          â”‚ â”‚
â”‚  â”‚ â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶   â”‚ â”‚
â”‚  â”‚  FREE  STARTER  PRO  ENTERPRISE                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Cold Start Latency    â”‚  â”‚ Circuit Breaker Status      â”‚  â”‚
â”‚  â”‚ (heatmap by cache lvl)â”‚  â”‚                             â”‚  â”‚
â”‚  â”‚                       â”‚  â”‚  proj_abc: CLOSED âœ…        â”‚  â”‚
â”‚  â”‚  L1 â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   â”‚  â”‚  proj_xyz: HALF-OPEN âš ï¸     â”‚  â”‚
â”‚  â”‚  L2 â–‘â–‘â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   â”‚  â”‚  proj_def: OPEN âŒ          â”‚  â”‚
â”‚  â”‚  L3 â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   â”‚  â”‚                             â”‚  â”‚
â”‚  â”‚  L4 â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘   â”‚  â”‚                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  Alert Status: ðŸŸ¢ All systems healthy                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. Intelligence Dashboard: "Tenant Activity Patterns"

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tenant Activity Patterns                            [Last 7d] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Query Rate Distribution by Tier (histogram)              â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚      â–“                     FREE                          â”‚ â”‚
â”‚  â”‚    â–“ â–“ â–“                   STARTER                       â”‚ â”‚
â”‚  â”‚  â–“â–“â–“â–“â–“â–“â–“â–“                  PRO                           â”‚ â”‚
â”‚  â”‚ â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“              ENTERPRISE                    â”‚ â”‚
â”‚  â”‚ â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶   â”‚ â”‚
â”‚  â”‚  0  1  5 10 30 60 120 300  (queries/min)                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Active Hours/Day     â”‚  â”‚ Tier Dwell Time (box plot)  â”‚  â”‚
â”‚  â”‚ (scatter by tier)    â”‚  â”‚                             â”‚  â”‚
â”‚  â”‚           â€¢          â”‚  â”‚  COLD  â”œâ”€â”€â”€â”€â”€â”€â”¤            â”‚  â”‚
â”‚  â”‚       â€¢   â€¢ â€¢        â”‚  â”‚  WARM  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚  â”‚
â”‚  â”‚   â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢    â”‚  â”‚  HOT   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚  â”‚
â”‚  â”‚ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢  â”‚  â”‚  PERS  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”¤â”‚  â”‚
â”‚  â”‚ â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â–¶  â”‚  â”‚        0  1d  7d  30d      â”‚  â”‚
â”‚  â”‚  F   S   P   E       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Cache Hit Rate by Tier & Level (heatmap)                 â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚       L1    L2    L3    L4                               â”‚ â”‚
â”‚  â”‚  FREE  95%   70%   40%   0%                              â”‚ â”‚
â”‚  â”‚  START 97%   80%   50%   0%                              â”‚ â”‚
â”‚  â”‚  PRO   98%   90%   60%   0%                              â”‚ â”‚
â”‚  â”‚  ENTER 99%   95%   70%   0%                              â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆ >90%   â–“â–“â–“â–“ 70-90%   â–‘â–‘â–‘â–‘ 50-70%   Â·Â·Â·Â· <50%      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. SLO Tracking Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DynaBase SLO Compliance                             [Last 30d]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  SLO Compliance by Tier                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   FREE   â”‚ STARTER  â”‚   PRO    â”‚ ENTERPRISE â”‚               â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
â”‚  â”‚          â”‚          â”‚          â”‚          â”‚               â”‚
â”‚  â”‚  97.2%   â”‚  99.1%   â”‚  99.6%   â”‚  99.95%  â”‚ Query Latency  â”‚
â”‚  â”‚  ðŸŸ¢      â”‚  ðŸŸ¢      â”‚  ðŸŸ¢      â”‚  ðŸŸ¢      â”‚               â”‚
â”‚  â”‚          â”‚          â”‚          â”‚          â”‚               â”‚
â”‚  â”‚  94.8%   â”‚  98.5%   â”‚  99.8%   â”‚   N/A    â”‚ Cold Start     â”‚
â”‚  â”‚  ðŸŸ¡      â”‚  ðŸŸ¢      â”‚  ðŸŸ¢      â”‚    -     â”‚               â”‚
â”‚  â”‚          â”‚          â”‚          â”‚          â”‚               â”‚
â”‚  â”‚  96.3%   â”‚  99.4%   â”‚  99.7%   â”‚  99.92%  â”‚ Availability   â”‚
â”‚  â”‚  ðŸŸ¢      â”‚  ðŸŸ¢      â”‚  ðŸŸ¢      â”‚  ðŸŸ¢      â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Error Budget Burn Rate (time series)                     â”‚ â”‚
â”‚  â”‚          â–²                                                â”‚ â”‚
â”‚  â”‚  100%    â”‚                                                â”‚ â”‚
â”‚  â”‚          â”‚  FREE â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                  â”‚ â”‚
â”‚  â”‚   50%    â”œâ”€ STARTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚ â”‚
â”‚  â”‚          â”‚    PRO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚ â”‚
â”‚  â”‚    0%    â”‚      ENTERPRISE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚ â”‚
â”‚  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚ â”‚
â”‚  â”‚            0d          15d           30d                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  Recent SLO Violations:                                        â”‚
â”‚  â€¢ 2025-11-20 14:23 - STARTER cold start >3s (3.2s) - 5min    â”‚
â”‚  â€¢ 2025-11-19 08:45 - FREE latency >500ms (620ms) - 12min     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Cardinality Analysis

**Estimated time series counts** (assuming 1000 active tenants):

| Metric Type | Labels | Cardinality | Series Count |
|-------------|--------|-------------|--------------|
| `tenant_current_tier` | project_id, database_type | 1000 Ã— 4 | **4,000** |
| `tenant_limit_hits_total` | project_id, tier, limit_type, action | 1000 Ã— 4 Ã— 4 Ã— 3 | **48,000** |
| `tenant_cache_hits_total` | project_id, tier, cache_level | 1000 Ã— 4 Ã— 4 | **16,000** |
| `tenant_query_rate_per_minute` | project_id, tier | 1000 Ã— 4 | **4,000** |
| `tenants_by_tier` | tier | 4 | **4** |
| `slo_*_compliance` | tier, threshold | 4 Ã— 3 | **12** |
| **Total** | | | **~72,000** |

**Mitigation strategies**:
- **Aggregate by tier** for overview dashboards (reduces to ~100 series)
- **On-demand drill-down** to project_id when investigating specific tenant
- **Metric retention**: 30 days high-res, 90 days downsampled, 1 year aggregated
- **Label pruning**: Drop inactive tenants after 7 days

---

## Alert Routing Matrix

| Severity | Tier Scope | Destination | Response SLA |
|----------|-----------|-------------|--------------|
| ðŸ”´ **Critical** | PRO, ENTERPRISE | PagerDuty â†’ On-call engineer | 5 minutes |
| ðŸ”´ **Critical** | STARTER | Slack #dynabase-ops | 15 minutes |
| ðŸ”´ **Critical** | FREE | Logged only | Best effort |
| ðŸŸ  **Warning** | All tiers | Slack #dynabase-ops | 1 hour |
| ðŸŸ¡ **Info** | All tiers | Slack #dynabase-analytics | No SLA |

---

## Query Performance Optimization

**Frequent queries** (pre-recorded rules to reduce dashboard load):

```yaml
# Pre-aggregated tier distribution (updated every 1m)
- record: dynabase:tenants_by_tier:count
  expr: count by (tier) (tenant_current_tier)

# Pre-calculated SLO compliance (updated every 5m)
- record: dynabase:slo_query_latency_compliance:ratio
  expr: |
    (
      sum(rate(db_query_duration_seconds_bucket{le="0.5"}[5m])) by (tier)
      /
      sum(rate(db_query_duration_seconds_count[5m])) by (tier)
    ) * 100

# Pre-aggregated cache hit rates (updated every 5m)
- record: dynabase:cache_hit_rate:ratio
  expr: |
    (
      sum(rate(tenant_cache_hits_total{cache_level!~"L4_miss"}[5m])) by (tier, cache_level)
      /
      sum(rate(tenant_cache_hits_total[5m])) by (tier, cache_level)
    ) * 100
```

---

**Visual Summary Complete** âœ…

This diagram complements the main observability strategy document with:
- Data flow architecture
- Metric namespace hierarchy
- Dashboard visual structures
- Cardinality analysis
- Alert routing matrix
- Query optimization patterns
