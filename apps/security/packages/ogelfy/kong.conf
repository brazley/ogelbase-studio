# Kong Configuration for Railway Deployment
# This file configures Kong's runtime behavior

# Database
database = off
declarative_config = /app/kong.yml
declarative_config_string = ${KONG_DECLARATIVE_CONFIG}

# Network listeners
proxy_listen = 0.0.0.0:${PORT:-8000}
admin_listen = 0.0.0.0:8001

# Admin API security (restrict in production)
admin_listen = 0.0.0.0:8001
# In production, bind to localhost only: admin_listen = 127.0.0.1:8001

# Logging
log_level = info
proxy_access_log = /dev/stdout
proxy_error_log = /dev/stderr
admin_access_log = /dev/stdout
admin_error_log = /dev/stderr

# Performance tuning
nginx_worker_processes = auto
nginx_worker_connections = 10240

# Upstream keepalive
upstream_keepalive_pool_size = 60
upstream_keepalive_max_requests = 100
upstream_keepalive_idle_timeout = 60

# Client settings
client_max_body_size = 10m
client_body_buffer_size = 8k

# Proxy settings
real_ip_header = X-Forwarded-For
real_ip_recursive = on
trusted_ips = 0.0.0.0/0,::/0

# DNS resolver (Railway uses 1.1.1.1)
dns_resolver = 1.1.1.1
dns_order = LAST,A,CNAME

# Plugins
plugins = bundled

# Router
router_flavor = traditional

# Nginx optimizations
nginx_http_client_header_buffer_size = 1k
nginx_http_large_client_header_buffers = 4 8k
