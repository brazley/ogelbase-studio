# Redis Sentinel Configuration
# Purpose: Monitor Redis cluster and coordinate automatic failover

# Network
bind 0.0.0.0
port 26379

# Security
requirepass ${REDIS_SENTINEL_PASSWORD}
sentinel auth-pass mymaster ${REDIS_PASSWORD}

# Sentinel identity
sentinel announce-ip ${SENTINEL_HOST}
sentinel announce-port 26379

# Monitor primary Redis instance
# Format: sentinel monitor <master-name> <ip> <port> <quorum>
# Quorum: 2/3 Sentinels must agree for failover
sentinel monitor mymaster ${PRIMARY_HOST} 6379 2

# Failure detection
# Time (ms) before marking instance as down
sentinel down-after-milliseconds mymaster 3000

# Parallel sync during failover
# Only 1 replica syncs from new primary at a time (safer)
sentinel parallel-syncs mymaster 1

# Failover timeout
# Max time for failover to complete before considering it failed
sentinel failover-timeout mymaster 10000

# Notification scripts (optional)
# sentinel notification-script mymaster /path/to/notify.sh
# sentinel client-reconfig-script mymaster /path/to/reconfig.sh

# Advanced settings
sentinel deny-scripts-reconfig yes

# Resolve DNS hostnames (Railway private network)
sentinel resolve-hostnames yes
sentinel announce-hostnames yes

# Logging
loglevel notice
logfile ""

# Sentinel will rewrite this file with topology changes
# Railway should mount /data for persistence
dir /data
