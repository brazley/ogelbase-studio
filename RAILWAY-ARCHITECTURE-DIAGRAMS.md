# Railway Architecture Diagrams - Before & After Private Network

## Current Architecture (Using Public URLs)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           User Browser                                  â”‚
â”‚                    (https://studio-*.railway.app)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ HTTPS (public)
                                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                    Studio Frontend                    â”‚
         â”‚              (Port 3000 - Public URL)                 â”‚
         â”‚                                                        â”‚
         â”‚  Environment:                                          â”‚
         â”‚  - NEXT_PUBLIC_SUPABASE_URL (public âœ…)               â”‚
         â”‚  - NEXT_PUBLIC_GOTRUE_URL (public âœ…)                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                        â”‚
                    â”‚ HTTP (public)          â”‚ HTTP (public)
                    â”‚ ğŸ’° Egress fees         â”‚ ğŸ’° Egress fees
                    â–¼                        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Postgres Meta     â”‚        â”‚    Kong Gateway      â”‚
    â”‚  (Port 8080)        â”‚        â”‚    (Port 8000)       â”‚
    â”‚  Public URL âŒ      â”‚        â”‚    Public URL âŒ     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                              â”‚
              â”‚ Postgres                     â”‚ HTTP
              â”‚ Public âŒ                    â”‚ Public âŒ
              â”‚ ğŸ’° Egress                    â”‚ ğŸ’° Egress
              â–¼                              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     Postgres        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”‚   Supabase Auth      â”‚
    â”‚    (Port 5432)      â”‚        â”‚    (Port 9999)       â”‚
    â”‚  Public URL âŒ      â”‚        â”‚    Public URL âŒ     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–²
              â”‚ Postgres
              â”‚ Public âŒ
              â”‚ ğŸ’° Egress
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚       MinIO         â”‚
    â”‚    (Port 9000)      â”‚
    â”‚  Public URL âŒ      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“Š Total Monthly Egress: ~111GB
ğŸ’° Total Monthly Cost: ~$11.10/month
```

---

## Optimized Architecture (Using Private Network)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           User Browser                                  â”‚
â”‚                    (https://studio-*.railway.app)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ HTTPS (public)
                                    â”‚ Only egress for user traffic
                                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                    Studio Frontend                    â”‚
         â”‚              (Port 3000 - Public URL)                 â”‚
         â”‚                                                        â”‚
         â”‚  Browser-facing (Public):                             â”‚
         â”‚  - NEXT_PUBLIC_SUPABASE_URL (public âœ…)               â”‚
         â”‚  - NEXT_PUBLIC_GOTRUE_URL (public âœ…)                 â”‚
         â”‚                                                        â”‚
         â”‚  Server-side (Private):                               â”‚
         â”‚  - POSTGRES_HOST=postgres.railway.internal            â”‚
         â”‚  - STUDIO_PG_META_URL=postgres-meta.railway.internal  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                        â”‚
                    â”‚                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Railway Private Network (FREE - No Egress Charges)                     â”‚
â”‚                   â”‚                        â”‚                            â”‚
â”‚                   â”‚ HTTP (private)         â”‚ HTTP (private)            â”‚
â”‚                   â”‚ âœ… FREE                â”‚ âœ… FREE                   â”‚
â”‚                   â–¼                        â–¼                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚   Postgres Meta     â”‚        â”‚    Kong Gateway      â”‚             â”‚
â”‚   â”‚  (Port 8080)        â”‚        â”‚    (Port 8000)       â”‚             â”‚
â”‚   â”‚  Private URL âœ…     â”‚        â”‚    Private URL âœ…    â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚             â”‚                              â”‚                            â”‚
â”‚             â”‚ Postgres                     â”‚ HTTP                      â”‚
â”‚             â”‚ Private âœ…                   â”‚ Private âœ…                â”‚
â”‚             â”‚ âœ… FREE                      â”‚ âœ… FREE                   â”‚
â”‚             â–¼                              â–¼                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚     Postgres        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”‚   Supabase Auth      â”‚             â”‚
â”‚   â”‚    (Port 5432)      â”‚        â”‚    (Port 9999)       â”‚             â”‚
â”‚   â”‚  Private URL âœ…     â”‚        â”‚    Private URL âœ…    â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚             â–²                                                           â”‚
â”‚             â”‚ Postgres                                                  â”‚
â”‚             â”‚ Private âœ…                                                â”‚
â”‚             â”‚ âœ… FREE                                                   â”‚
â”‚             â”‚                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚   â”‚       MinIO         â”‚                                              â”‚
â”‚   â”‚    (Port 9000)      â”‚                                              â”‚
â”‚   â”‚  Private URL âœ…     â”‚                                              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“Š Total Monthly Egress: ~18GB (only browser traffic)
ğŸ’° Total Monthly Cost: ~$1.80/month
âœ¨ Savings: $9.30/month (84% reduction)
```

---

## Network Traffic Flow - Before vs After

### Before: All Traffic Over Public Internet

```
Studio API Route (SSR):
  â”Œâ”€â”€â”€â”€â”€â”€â”  Public   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Public   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚Studioâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Postgres â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Client  â”‚
  â””â”€â”€â”€â”€â”€â”€â”˜  ğŸ’° Cost  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  ğŸ’° Cost  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Database Query from Kong:
  â”Œâ”€â”€â”€â”€â”€â”€â”  Public   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Kong â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Postgres â”‚
  â””â”€â”€â”€â”€â”€â”€â”˜  ğŸ’° Cost  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Auth Validation:
  â”Œâ”€â”€â”€â”€â”€â”€â”  Public   â”Œâ”€â”€â”€â”€â”€â”€â”  Public   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Kong â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Auth â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Postgres â”‚
  â””â”€â”€â”€â”€â”€â”€â”˜  ğŸ’° Cost  â””â”€â”€â”€â”€â”€â”€â”˜  ğŸ’° Cost  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Every arrow = Egress charge
```

### After: Internal Traffic Over Private Network

```
Studio API Route (SSR):
  â”Œâ”€â”€â”€â”€â”€â”€â”  Private  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Public   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚Studioâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Postgres â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Client  â”‚
  â””â”€â”€â”€â”€â”€â”€â”˜  âœ… FREE  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  ğŸ’° Cost  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Database Query from Kong:
  â”Œâ”€â”€â”€â”€â”€â”€â”  Private  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Kong â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Postgres â”‚
  â””â”€â”€â”€â”€â”€â”€â”˜  âœ… FREE  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Auth Validation:
  â”Œâ”€â”€â”€â”€â”€â”€â”  Private  â”Œâ”€â”€â”€â”€â”€â”€â”  Private  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Kong â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Auth â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Postgres â”‚
  â””â”€â”€â”€â”€â”€â”€â”˜  âœ… FREE  â””â”€â”€â”€â”€â”€â”€â”˜  âœ… FREE  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Only public (Client) arrow = Egress charge
Internal arrows = FREE
```

---

## Service Communication Matrix - Visual

### Current (All Public - All Costs Money)

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Studio  â”‚ Kong â”‚ Auth â”‚ PG Meta â”‚ MinIO â”‚Postgresâ”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Studio â”‚    -    â”‚  ğŸ’°  â”‚  -   â”‚   ğŸ’°    â”‚   -   â”‚   ğŸ’°   â”‚
â”‚Kong   â”‚    -    â”‚  -   â”‚  ğŸ’°  â”‚    -    â”‚  ğŸ’°   â”‚   ğŸ’°   â”‚
â”‚Auth   â”‚    -    â”‚  -   â”‚  -   â”‚    -    â”‚   -   â”‚   ğŸ’°   â”‚
â”‚PG Metaâ”‚    -    â”‚  -   â”‚  -   â”‚    -    â”‚   -   â”‚   ğŸ’°   â”‚
â”‚MinIO  â”‚    -    â”‚  -   â”‚  ğŸ’°  â”‚    -    â”‚   -   â”‚   ğŸ’°   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’° = Egress cost
- = No communication
```

### After Private Network (All Internal - FREE)

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Studio  â”‚ Kong â”‚ Auth â”‚ PG Meta â”‚ MinIO â”‚Postgresâ”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Studio â”‚    -    â”‚  âœ…  â”‚  -   â”‚   âœ…    â”‚   -   â”‚   âœ…   â”‚
â”‚Kong   â”‚    -    â”‚  -   â”‚  âœ…  â”‚    -    â”‚  âœ…   â”‚   âœ…   â”‚
â”‚Auth   â”‚    -    â”‚  -   â”‚  -   â”‚    -    â”‚   -   â”‚   âœ…   â”‚
â”‚PG Metaâ”‚    -    â”‚  -   â”‚  -   â”‚    -    â”‚   -   â”‚   âœ…   â”‚
â”‚MinIO  â”‚    -    â”‚  -   â”‚  âœ…  â”‚    -    â”‚   -   â”‚   âœ…   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… = FREE (private network)
- = No communication
```

---

## Egress Reduction by Service

### Visual Breakdown

```
BEFORE Private Network:

Studio    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 48GB ($4.80)
Kong      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 35GB ($3.50)
Auth      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 15GB ($1.50)
PG Meta   â–ˆâ–ˆâ–ˆâ–ˆ 8GB ($0.80)
MinIO     â–ˆâ–ˆ 5GB ($0.50)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL: 111GB ($11.10/month)


AFTER Private Network:

Studio    â–ˆâ–ˆâ–ˆ 6GB ($0.60)
Kong      â–ˆâ–ˆâ–ˆâ–ˆ 8GB ($0.80)
Auth      â–ˆ 2GB ($0.20)
PG Meta   â–ˆ 1GB ($0.10)
MinIO     â–ˆ 1GB ($0.10)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL: 18GB ($1.80/month)

SAVINGS: 93GB ($9.30/month) ğŸ‰
```

---

## URL Mapping Reference

### Quick Copy-Paste for Migration

```bash
# Old (Public) â†’ New (Private)

# Postgres
maglev.proxy.rlwy.net:20105 â†’ postgres.railway.internal:5432

# Kong
kong-production-80c6.up.railway.app:8000 â†’ kong.railway.internal:8000

# Auth
supabase-auth-production-aa86.up.railway.app:9999 â†’ supabase-auth.railway.internal:9999

# Postgres Meta
postgres-meta-production-6c48.up.railway.app:8080 â†’ postgres-meta.railway.internal:8080

# MinIO
minio-production-f65d.up.railway.app:9000 â†’ minio.railway.internal:9000

# Studio (internal only - browser keeps public)
studio-production-cfcd.up.railway.app:3000 â†’ studio.railway.internal:3000
```

---

## Environment Variable Decision Tree

```
Is this variable prefixed with NEXT_PUBLIC_*?
â”‚
â”œâ”€ YES â†’ MUST stay public (sent to browser)
â”‚   â””â”€ Examples:
â”‚       - NEXT_PUBLIC_SUPABASE_URL
â”‚       - NEXT_PUBLIC_GOTRUE_URL
â”‚       - NEXT_PUBLIC_SUPABASE_ANON_KEY
â”‚
â””â”€ NO â†’ Should it be private?
    â”‚
    â”œâ”€ Used only in API routes/SSR? â†’ YES, make private
    â”‚   â””â”€ Examples:
    â”‚       - POSTGRES_HOST
    â”‚       - STUDIO_PG_META_URL
    â”‚       - DATABASE_URL
    â”‚
    â”œâ”€ Used for service-to-service? â†’ YES, make private
    â”‚   â””â”€ Examples:
    â”‚       - GOTRUE_DB_DATABASE_URL (Auth â†’ Postgres)
    â”‚       - STORAGE_POSTGRES_URL (Storage â†’ Postgres)
    â”‚
    â””â”€ Used for external webhooks/APIs? â†’ NO, keep public
        â””â”€ Examples:
            - Stripe webhook URLs
            - External service callbacks
```

---

## Migration Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Backup Current Config                               â”‚
â”‚ railway variables --service [name] --json > backup.json     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Add Private Network Variables                       â”‚
â”‚ railway variables set VAR_INTERNAL=*.railway.internal       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Deploy & Test                                       â”‚
â”‚ railway up --service [name]                                 â”‚
â”‚ (Old public URLs still work as fallback)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                     â”‚           â”‚
                  Works?         â”‚
                     â”‚           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”    â”‚
              â”‚             â”‚    â”‚
             YES           NO    â”‚
              â”‚             â”‚    â”‚
              â–¼             â–¼    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Step 4:      â”‚  â”‚ Rollback:    â”‚
    â”‚Switch to    â”‚  â”‚ Revert to    â”‚
    â”‚Private      â”‚  â”‚ Public URLs  â”‚
    â”‚as Primary   â”‚  â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Step 5:      â”‚
    â”‚Monitor      â”‚
    â”‚for 24hrs    â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Step 6:      â”‚
    â”‚Cleanup      â”‚
    â”‚Remove old   â”‚
    â”‚variables    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Cost Breakdown Visual

```
Monthly Egress Costs:

BEFORE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Studio â†’ Postgres:     $2.00           â”‚
â”‚ Studio â†’ Kong:         $1.80           â”‚
â”‚ Kong â†’ Postgres:       $1.50           â”‚
â”‚ Kong â†’ Auth:           $1.00           â”‚
â”‚ Auth â†’ Postgres:       $0.80           â”‚
â”‚ Studio â†’ PG Meta:      $0.70           â”‚
â”‚ Other internal:        $0.50           â”‚
â”‚ Browser traffic:       $2.80           â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ TOTAL:                $11.10/month     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AFTER:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Studio â†’ Postgres:     $0.00 (private) â”‚
â”‚ Studio â†’ Kong:         $0.00 (private) â”‚
â”‚ Kong â†’ Postgres:       $0.00 (private) â”‚
â”‚ Kong â†’ Auth:           $0.00 (private) â”‚
â”‚ Auth â†’ Postgres:       $0.00 (private) â”‚
â”‚ Studio â†’ PG Meta:      $0.00 (private) â”‚
â”‚ Other internal:        $0.00 (private) â”‚
â”‚ Browser traffic:       $1.80           â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ TOTAL:                 $1.80/month     â”‚
â”‚ SAVINGS:               $9.30/month âœ¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ROI: 84% cost reduction
Time to implement: 2-4 hours
```

---

**Last Updated:** 2025-11-21
**Diagrams:** ASCII art for terminal viewing
**Status:** Ready for implementation
