# MySQL/MariaDB Setup Verification

**Date**: 2025-11-22
**Status**: Deployed, needs verification

---

## What Railway Deployed

When you add MySQL via Railway dashboard, it typically creates:
- **One database service** (either MySQL 8.x or MariaDB 10.x)
- Both are MySQL-compatible
- Appwrite works with either

**Note**: Railway may show "MySQL" but actually deploy MariaDB, or vice versa. They're interchangeable for our purposes.

---

## Verify Setup via Railway Dashboard

### Step 1: Check Service Name

Go to Railway dashboard → OgelBase project

**Look for a service named**:
- `mysql` or
- `mariadb` or
- `MySQL` or
- Similar

### Step 2: Get Internal Connection Details

Click on the MySQL/MariaDB service → **Variables** tab

**You should see**:
```bash
# Railway automatically creates these:
MYSQL_URL=mysql://root:xxxxx@mysql.railway.internal:3306/railway
MYSQL_HOST=mysql.railway.internal
MYSQL_PORT=3306
MYSQL_USER=root
MYSQL_PASSWORD=<auto-generated>
MYSQL_DATABASE=railway

# Or MariaDB variants:
MARIADB_URL=...
MARIADB_HOST=mariadb.railway.internal
```

**✅ CRITICAL**: Use the `*.railway.internal` hostname (internal URL)

---

## Connection Test

### From Your Local Machine

```bash
# Switch to the MySQL service
railway link

# Then select the MySQL/MariaDB service when prompted

# Test connection
railway run mysql -h mysql.railway.internal -u root -p
# Enter password from MYSQL_PASSWORD variable

# Or if it's named mariadb:
railway run mysql -h mariadb.railway.internal -u root -p
```

### From Another Railway Service

Create a test endpoint in Studio to verify connectivity:

```typescript
// apps/studio/pages/api/test/mysql-connection.ts

import mysql from 'mysql2/promise';

export default async function handler(req, res) {
  try {
    const connection = await mysql.createConnection({
      host: process.env.MYSQL_HOST || 'mysql.railway.internal',
      port: 3306,
      user: process.env.MYSQL_USER || 'root',
      password: process.env.MYSQL_PASSWORD,
      database: process.env.MYSQL_DATABASE || 'railway',
    });

    await connection.execute('SELECT 1 + 1 AS result');
    await connection.end();

    return res.json({
      success: true,
      message: 'MySQL connection successful',
      host: process.env.MYSQL_HOST,
    });
  } catch (error) {
    return res.status(500).json({
      success: false,
      error: error.message,
    });
  }
}
```

---

## Environment Variables Setup

### For Studio Service

If you want Studio to access MySQL, add these variables to the Studio service:

```bash
# In Railway: Studio service → Variables
MYSQL_HOST=mysql.railway.internal  # or mariadb.railway.internal
MYSQL_PORT=3306
MYSQL_USER=root
MYSQL_PASSWORD=<copy from MySQL service variables>
MYSQL_DATABASE=railway
```

### For Future Ogel Ghost Service

When deploying Ogel Ghost, it will need:

```bash
# Ogel Ghost expects these variable names:
_APP_DB_HOST=mysql.railway.internal
_APP_DB_PORT=3306
_APP_DB_USER=root
_APP_DB_PASS=<copy from MySQL service>
_APP_DB_SCHEMA=appwrite

# Create the appwrite database first:
# railway run mysql -h mysql.railway.internal -u root -p
# mysql> CREATE DATABASE appwrite;
```

---

## Database Setup for Ogel Ghost

### Create Appwrite Database

```bash
# Connect to MySQL
railway link  # Select MySQL service
railway run mysql -h mysql.railway.internal -u root -p

# Inside MySQL shell:
CREATE DATABASE appwrite CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
SHOW DATABASES;
EXIT;
```

### Verify Database Created

```bash
railway run mysql -h mysql.railway.internal -u root -p -e "SHOW DATABASES;"
```

Should see:
```
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| railway            |
| appwrite           |
+--------------------+
```

---

## Internal URL Configuration

### ✅ CORRECT: Internal URLs

**For all Railway services**:
```bash
mysql.railway.internal:3306
```

**Benefits**:
- Free (no egress charges)
- Fast (same private network)
- Secure (not exposed publicly)

### ❌ WRONG: Public URLs

**Never use**:
```bash
mysql-production-xyz.up.railway.app:3306
```

**Problems**:
- Costs $0.10/GB egress
- Slower (goes through public internet)
- Security risk (public exposure)

---

## Common Issues & Fixes

### Issue 1: Can't Connect

**Symptoms**: `Connection refused` or `Host not found`

**Fix**:
- Verify you're using `*.railway.internal` hostname
- Check Railway private network is enabled (it should be by default)
- Verify MySQL service is running (Railway dashboard)

### Issue 2: Wrong Service Name

**Symptoms**: Variables not found

**Fix**:
```bash
# Check exact service name
railway status

# Link to correct service
railway link
# Select the MySQL/MariaDB service from list
```

### Issue 3: Password Issues

**Symptoms**: `Access denied for user 'root'`

**Fix**:
- Copy exact password from Railway dashboard (MySQL service → Variables)
- Don't type it manually (copy-paste to avoid typos)
- Password is in `MYSQL_PASSWORD` variable

---

## Configuration Summary

### What You Should Have

```
Railway Services:
├── studio (existing)
├── postgres-primary (existing)
├── redis-primary (existing)
├── mongodb (existing)
└── mysql (NEW) ← or "mariadb"
    ├── Internal: mysql.railway.internal:3306
    ├── Database: railway (default)
    └── User: root
```

### What Ogel Ghost Needs

```bash
# Database connection
_APP_DB_HOST=mysql.railway.internal
_APP_DB_PORT=3306
_APP_DB_USER=root
_APP_DB_PASS=<from Railway>
_APP_DB_SCHEMA=appwrite

# Redis connection (shared)
_APP_REDIS_HOST=redis.railway.internal
_APP_REDIS_PORT=6379
_APP_REDIS_USER=default
_APP_REDIS_PASS=<from Railway>
```

---

## Next Steps

1. **Verify service name**
   - Go to Railway dashboard
   - Note exact name (mysql, mariadb, etc.)

2. **Get internal URL**
   - Check Variables tab
   - Find `*_HOST` variable
   - Should be `*.railway.internal`

3. **Test connection**
   - Use `railway run mysql -h <host> -u root -p`
   - Verify you can connect

4. **Create appwrite database**
   - Run `CREATE DATABASE appwrite;`
   - Ready for Ogel Ghost!

5. **Update documentation**
   - Replace `mysql.railway.internal` with actual hostname if different
   - Share connection details with team

---

## Ready for Ogel Ghost?

Once verified:
- ✅ MySQL/MariaDB running
- ✅ Internal URL confirmed (`*.railway.internal`)
- ✅ Connection tested
- ✅ `appwrite` database created

**Then**: Deploy Ogel Ghost pointing to this database

---

**Document created by**: Dylan Torres (TPM)
**Date**: 2025-11-22
**Status**: Verification in progress
