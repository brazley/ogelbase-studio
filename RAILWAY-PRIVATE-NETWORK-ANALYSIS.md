# Railway Private Network Configuration Analysis
**Generated**: 2025-11-21 23:32:04
**Project**: OgelBase
**Environment**: production

## Executive Summary

The Studio service is **ALREADY PARTIALLY** configured for private networking. Most internal services are using private Railway URLs correctly. However, there are some public URLs that should be switched to private for optimal security and performance.

## Current Configuration Status

### ✅ Already Using Private Network
- `DATABASE_URL`: postgres.railway.internal:5432 ✓
- `MONGODB_URL`: mongodb.railway.internal:27017 ✓
- `REDIS_URL`: redis.railway.internal:6379 ✓
- `STUDIO_PG_META_URL`: http://postgres-meta.railway.internal:8080 ✓
- `SUPABASE_URL`: http://kong.railway.internal:8000 ✓
- `SUPABASE_PUBLIC_URL`: kong.railway.internal ✓

### ⚠️ Needs Investigation/Change
These variables reference public Railway URLs but may need to remain public depending on use case:

- `RAILWAY_SERVICE_KONG_URL`: kong-production-80c6.up.railway.app
- `RAILWAY_SERVICE_MINIO_URL`: minio-production-f65d.up.railway.app
- `RAILWAY_SERVICE_POSTGRES_META_URL`: postgres-meta-production-6c48.up.railway.app
- `RAILWAY_SERVICE_SERVER_URL`: server-production-fdb5.up.railway.app
- `RAILWAY_SERVICE_SUPABASE_AUTH_URL`: supabase-auth-production-aa86.up.railway.app

**Note**: These `RAILWAY_SERVICE_*_URL` variables are **auto-generated by Railway** and may be used for external/public access. They should likely remain as-is unless we're explicitly using them for internal service-to-service communication.

## Railway Service Discovery

Based on the environment variables, these services exist in the Railway project:

| Service Name (inferred) | Private Network URL | Public URL | Port |
|------------------------|---------------------|------------|------|
| postgres | postgres.railway.internal | N/A | 5432 |
| mongodb | mongodb.railway.internal | N/A | 27017 |
| redis | redis.railway.internal | N/A | 6379 |
| postgres-meta | postgres-meta.railway.internal | postgres-meta-production-6c48.up.railway.app | 8080 |
| kong | kong.railway.internal | kong-production-80c6.up.railway.app | 8000 |
| minio | minio.railway.internal | minio-production-f65d.up.railway.app | 9000 (assumed) |
| supabase-auth | supabase-auth.railway.internal | supabase-auth-production-aa86.up.railway.app | 9999 (assumed) |
| server | server.railway.internal | server-production-fdb5.up.railway.app | Unknown |
| site | site.railway.internal | site-production-eb00.up.railway.app | Unknown |
| studio | studio.railway.internal | studio-production-cfcd.up.railway.app | 3000 |

## Discrepancies Found

### 1. Local .env.production vs Railway Variables

**Local File** (`/Users/quikolas/Documents/GitHub/supabase-master/apps/studio/.env.production`):
- Uses **PUBLIC** URLs for most services
- Example: `SUPABASE_URL=https://kong-production-80c6.up.railway.app`

**Railway Environment**:
- Uses **PRIVATE** URLs for internal services
- Example: `SUPABASE_URL=http://kong.railway.internal:8000`

**VERDICT**: The Railway environment is configured correctly. The local `.env.production` file appears outdated and should be updated to match Railway's configuration (or removed if not used for local development).

### 2. NEXT_PUBLIC Variables

The local `.env.production` has frontend-accessible variables that **MUST** remain public:
```
NEXT_PUBLIC_SITE_URL=https://ogelbase-studio.vercel.app
NEXT_PUBLIC_SUPABASE_URL=https://kong-production-80c6.up.railway.app
NEXT_PUBLIC_API_URL=https://ogelbase-studio.vercel.app/api
```

These are correct - they're for browser-side access and must use public URLs.

## Backup Information

**Backup File**: `/Users/quikolas/Documents/GitHub/supabase-master/studio-vars-backup-20251121-233204.json`
- Contains complete snapshot of all Studio environment variables
- Created: 2025-11-21 23:32:04
- Size: 2.4 KB
- Format: JSON

## Recommendations

### No Changes Needed for Internal Communication
The Studio service is already correctly configured to use private network URLs for internal service-to-service communication. The primary internal services (Postgres, Redis, MongoDB, Kong, Postgres-Meta) are all using `.railway.internal` domains.

### Potential Action Items

1. **Update Local .env.production** (Optional)
   - Align local `.env.production` with Railway's configuration
   - Or remove it if not used for local development
   - This prevents confusion between local and deployed configs

2. **Investigate RAILWAY_SERVICE_* Variables**
   - Determine if these auto-generated variables are used anywhere
   - If used for internal calls, consider switching to private URLs
   - If used for external/webhook callbacks, keep as-is

3. **Document Service Ports**
   - Confirm actual ports for unknown services (minio, supabase-auth, server, site)
   - Add to internal documentation

## Service Name Clarification

**Important**: Railway CLI service names may differ from service hostnames. Based on the variables:
- Service CLI name might be different (e.g., `Auth` vs `supabase-auth`)
- Private network hostnames are what matter for internal communication
- Use `railway variables --service <name>` to test each service name

## Next Steps for Todo #1 (Marcus)

When Marcus checks API routes, verify these variables are used correctly:
- `SUPABASE_URL` - Should use private URL: `http://kong.railway.internal:8000`
- `STUDIO_PG_META_URL` - Should use private URL: `http://postgres-meta.railway.internal:8080`
- `DATABASE_URL` - Already using private URL correctly

## Change Plan (If Needed)

If Marcus discovers API routes using public URLs, here's the change strategy:

```bash
# Example command structure (NOT EXECUTED YET)
railway variables --service studio --set VARIABLE_NAME="new-value"
```

**Variables to potentially update**:
```bash
# None identified yet - most are already correct
# Waiting on Marcus's API route analysis
```

## Security Notes

1. **Private Network Benefits**:
   - No egress charges for internal communication
   - Reduced latency
   - Traffic never leaves Railway's internal network
   - No exposure to internet for internal services

2. **Current Security Posture**: GOOD
   - Core services (DB, cache, internal APIs) using private network
   - Public URLs only where necessary (browser-facing, webhooks)

## Questions for Verification

1. Are `RAILWAY_SERVICE_*_URL` variables actually used in code, or just informational?
2. Should Minio (storage) be accessible publicly or only internally?
3. What is the "server" service and does it need public access?
4. What is the "site" service and its purpose?

---

**Status**: Ready for Marcus's API route analysis (Todo #1)
**Next**: Wait for Marcus to verify API routes before making any changes
**Confidence**: HIGH - Most configuration is already correct
